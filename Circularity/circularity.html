<!DOCTYPE HTML>
<html>

<head>
    <style>
        #canvas {
            border-style: solid;
            border-width: 2px;
        }
    </style>
</head>

<body>
    <canvas id="canvas" height="500" width="750"> </canvas>
</body>

</html>
<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    var direcTop = [];
    var direcLeft = [];
    var circles = ["30-30", "150-90", "270-210"];
    var allx = [];
    var ally = [];
    var speed = 1;

    setInterval(movement, 5);

    for (var i = 0; i < circles.length; i++) {
        var curCircle = circles[i];
        curCircle.split("-");
        allx.push(parseInt(curCircle[0], 10));
        ally.push(parseInt(curCircle[1], 10));
        direcTop.push(1);
        direcLeft.push(1);
    }


    //current problem: all of the circles except 1 (i think) stop moving for split seconds
    function movement() {
        const odirTop = direcTop;
        const odirLeft = direcLeft;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (var i = 0; i < circles.length; i++) {
            var curCircle = circles[i];
            curCircle.split("-");
            var posx = parseInt(curCircle.split("-")[0], 10);
            var posy = parseInt(curCircle.split("-")[1], 10);
            var curDirecLeft = direcLeft[i];
            var curDirecTop = direcTop[i];

            //collision checker
            var allxCopy = allx;
            var allyCopy = ally;
            allxCopy.splice(i, 1);
            allxCopy.splice(i, 1);
            for (var j = 0; j < allxCopy.length; j++) {
                if (j >= i) {
                    var jInd = j + 1;
                } else {
                    var jInd = j;
                }
                //collision with another box
                if (Math.hypot(Math.abs(posx) - Math.abs(allxCopy[j]), Math.abs(posy) - Math.abs(allyCopy[j])) <= 50) {
                    if (curDirecLeft === odirLeft[i]) {
                        curDirecLeft = curDirecLeft * -1;
                    }
                    if (curDirecTop === odirTop[i]) {
                        curDirecTop = curDirecTop * -1;
                    }
                    if (direcLeft[jInd] === odirLeft[jInd]) {
                        direcLeft[jInd] = direcLeft[jInd] * -1;
                    }
                    if (direcTop[jInd] === odirTop[jInd]) {
                        direcTop[jInd] = direcTop[jInd] * -1;
                    }
                }
            }
            //collisions with sides
            //collision on side
            if (canvas.width - Math.abs(posx) <= 25 && curDirecLeft === odirLeft[i]) {
                curDirecLeft = curDirecLeft * -1;
            }
            if (Math.abs(posx) <= 25 && curDirecLeft === odirLeft[i]) {
                curDirecLeft = curDirecLeft * -1;
            }
            //collision on top/bottom
            if (canvas.height - Math.abs(posy) <= 25 && curDirecTop === odirTop[i]) {
                curDirecTop = curDirecTop * -1;
            }
            if (Math.abs(posy) <= 25 && curDirecTop === odirTop[i]) {
                curDirecTop = curDirecTop * -1;
            }

            //right
            if (curDirecLeft === 1) {
                posx += speed;
            }
            //left
            if (curDirecLeft === -1) {
                posx = posx - speed;
            }
            //down
            if (curDirecTop === 1) {
                posy += speed;
            }
            //up
            if (curDirecTop === -1) {
                posy = posy - speed;
            }

            //putting all the info back into arrays
            direcTop[i] = curDirecTop;
            direcLeft[i] = curDirecLeft;
            allx[i] = posx;
            ally[i] = posy;
            circles[i] = "" + posx + "-" + posy + "";
            ctx.beginPath();
            ctx.fillStyle = '#034efc';
            ctx.arc(posx, posy, 25, 0, 2 * Math.PI);
            ctx.fill();
        }
    }
</script>